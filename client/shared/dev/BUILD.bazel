load("@aspect_rules_js//js:defs.bzl", "js_binary", "js_library")
load("//dev:defs.bzl", "ts_project")

# gazelle:ignore

js_binary(
    name = "generate_schema",
    data = [
        "//:node_modules/json-schema-to-typescript",
        "//:node_modules/mz",
    ],
    entry_point = "generateSchema.js",
    visibility = ["//client/shared:__pkg__"],
)

js_library(
    name = "extract_graphql_operation_codegen_plugin",
    srcs = [
        "extractGraphQlOperationCodegenPlugin.js",
    ],
    deps = [
        "//:node_modules/graphql",
        "//:node_modules/signale",
    ],
)

js_binary(
    name = "generate_graphql_operations",
    data = [
        ":extract_graphql_operation_codegen_plugin",
        "//:node_modules/@graphql-codegen/cli",
        "//:node_modules/@graphql-codegen/typescript",
        "//:node_modules/@graphql-codegen/typescript-apollo-client-helpers",
        "//:node_modules/@graphql-codegen/typescript-operations",
        "//:node_modules/prettier",
        "//cmd/frontend/graphqlbackend:graphql_schema",
    ],
    entry_point = "generateGraphQlOperations.js",
    visibility = ["//client:__subpackages__"],
)

ts_project(
    name = "mock-ts",
    testonly = True,
    srcs = [
        "mockDomRect.ts",
        "mockMatchMedia.ts",
        "mockReactVisibilitySensor.tsx",
        "mockResizeObserver.ts",
        "mockSentryBrowser.ts",
        "mockUniqueId.ts",
        "reactCleanup.ts",
        "setLinkComponentForTest.ts",
    ],
    visibility = ["//visibility:private"],
    deps = [
        "//:node_modules/@sentry/browser",
        "//:node_modules/@sourcegraph/wildcard",
        "//:node_modules/@testing-library/react",
        "//:node_modules/@types/node",
        "//:node_modules/@types/react",
        "//:node_modules/react",
        "//:node_modules/react-visibility-sensor",
        "//:node_modules/resize-observer-polyfill",
    ],
)

js_library(
    name = "mock",
    testonly = True,
    srcs = [
        "fetch.js",
        "jest-environment.js",
        "jestGlobalSetup.js",
        "mockDate.js",
        ":mock-ts",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "//:node_modules/@peculiar/webcrypto",
        "//:node_modules/jest-environment-jsdom",
        "//:node_modules/node-fetch",
    ],
)
